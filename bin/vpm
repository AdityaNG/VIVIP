#!/usr/bin/python

# TODO : Add CLI functionality 

import argparse
import os
import sys

import libvpm
"""
vpm --setup
vpm -s

vpm --install <package>
vpm -i <package>

vpm --update <package>
vpm -u <package>

vpm --remove <package>
vpm -r <package>

vpm --list
vpm -l
"""

argparser = argparse.ArgumentParser(description="Verilog Package Manager")
argparser.add_argument('-s', '--setup', help='Setup current directory as Verilog Package')
argparser.add_argument('-i', '--install', help='Install a package', nargs='+')
argparser.add_argument('-u', '--update', help='Update a package [vpm -u * to update all]', nargs='+')
argparser.add_argument('-r', '--remove', help='Remove a package [vpm -r * to remove all]', nargs='+')
argparser.add_argument('-l', '--list', help='List all packages')
args = argparser.parse_args()

if True:
#try:
    if args.setup:
        
        setup_dir = os.path.join(os.getcwd(), args.setup)
        #print(setup_dir)
        if libvpm.utils.is_vpm_dir(setup_dir):
            print("Already VPM directory")
            exit(0)
        """
        if libvpm.is_vpm_dir(setup_dir):
            print("Already a VPM directory")
            exit(0)
        """
        # Setup "vpackage.json"
        packageName = input("Enter Package Name : ")
        packageAuthors = input("Enter Authors [space seperated] : ").split(' ')
        packageURL = input("Enter package remote URL [optional] : ")

        libvpm.setup(setup_dir, packageName=packageName, packageAuthors=packageAuthors, packageURL=packageURL)
    else:
        """
        if not libvpm.is_vpm_dir(os.getcwd()):
            print("Not a VPM directory")
            exit(0)
        """
        # Check for remaining options
        if args.install:
            #print(os.path.join(os.getcwd(), '.'))
            #libvpm.install(os.path.join(os.getcwd(), '.'), args.install)
            libvpm.install(os.getcwd(), args.install)
        elif args.update:
            libvpm.update(os.getcwd(), args.update)
        elif args.remove:
            libvpm.remove(os.getcwd(), args.remove)
        elif args.list:
            libvpm.list_vpm(os.getcwd())
        else:
            argparser.print_help()

#except Exception as e: print(e)

#print(args)
#print(os.getcwd())